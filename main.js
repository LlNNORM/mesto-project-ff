(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function n(e){t(e.target.closest(".popup"))}function o(e){var n=document.querySelector(".popup_is-opened");"Escape"===e.key&&t(n)}function r(e){e.target===e.currentTarget&&t(e.target)}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent=n,e.disabled=!1)}function c(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,a=t.inputErrorClass,c=t.errorClass,l=Array.from(e.querySelectorAll("".concat(n))),s=e.querySelector("".concat(o));l.forEach((function(t){t.setCustomValidity(""),u(e,t,a,c)})),i(l,s,r)}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("".concat(n))):(t.disabled=!0,t.classList.add("".concat(n)))}function u(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(n)),r.classList.remove("".concat(o)),r.textContent=""}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-25",headers:{authorization:"0e54a225-fa4c-4f04-a036-c9ec4e520337","Content-Type":"application/json"}};function s(e,t){return fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return v(e)}))}function d(e,t){return fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return v(e)}))}function p(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return v(e)}))}function f(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return v(e)}))}function m(e){return fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e.value})}).then((function(e){return v(e)}))}function v(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var h,_=document.querySelector(".places__list"),S=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),g=document.querySelectorAll(".popup__close"),k=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),L=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_edit"),I=document.forms["edit-profile"],P=I.elements.name,q=I.elements.description,x=I.elements["save-button"],A=document.querySelector(".popup_type_edit-profile-image"),B=document.forms["edit-profile-photo"],D=B.elements.link,U=document.querySelector(".profile__image"),w=B.elements["save-button"],T=document.querySelector(".popup_type_new-card"),j=document.forms["new-place"],O=j.elements["place-name"],M=j.elements.link,N=j.elements["save-button"],J=document.querySelector(".popup_type_image"),V=document.querySelector(".popup__image"),F=document.querySelector(".popup__caption"),H=document.querySelector(".popup_type_delete"),z=H.querySelector(".popup__button_type_confirmation"),$={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function G(t){var n=t.cardList,o=t.cardsContainer,r=t.openImagePopup,a=t.positionBefore;n.forEach((function(t){var n=function(e){var t=e.cardData,n=e.cardDeletePopup,o=e.openPopup,r=e.openImagePopup,a=e.userId,c=e.addLike,i=e.deleteLike,u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-counter"),p=u.querySelector(".card__image"),f=u.querySelector(".card__title"),m=function(e,t){return e.map((function(e){return e._id})).includes(t)}(t.likes,a),v=t._id,y=t.owner._id;return u.dataset.id=v,y===a&&s.classList.add("card__delete-button-visible"),s.addEventListener("click",(function(){o(n),localStorage.setItem("deletedCardId",v)})),m&&l.classList.add("card__like-button_is-active"),p.src=t.link,p.alt="".concat(t.name," фото"),f.textContent=t.name,d.textContent=t.likes.length,p.addEventListener("click",(function(){return r(t.link,f.textContent)})),l.addEventListener("click",(function(){m=function(e){var t=e.cardId,n=e.likeButton,o=e.likeCounter,r=e.addLike,a=e.liked;return a?((0,e.deleteLike)(t).then((function(e){return o.textContent=e.likes.length})).catch((function(e){return console.log(e)})),n.classList.remove("card__like-button_is-active")):(r(t).then((function(e){return o.textContent=e.likes.length})).catch((function(e){return console.log(e)})),n.classList.add("card__like-button_is-active")),!a}({liked:m,cardId:v,likeButton:l,likeCounter:d,addLike:c,deleteLike:i})})),u}({cardData:t,cardDeletePopup:H,openPopup:e,openImagePopup:r,userId:h,addLike:p,deleteLike:f});return a?o.prepend(n):o.append(n)}))}function K(t,n){e(J),V.src=t,V.alt="".concat(n," фото"),F.textContent=n}Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return v(e)})).then((function(e){return e})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return v(e)}))]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];U.style="background-image: url(".concat(r.avatar,");"),k.textContent=r.name,C.textContent=r.about,h=r._id,G({cardList:a,cardsContainer:_,openImagePopup:K,positionBefore:!1})})).catch((function(e){console.log(e)})),L.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",r)})),function(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,a=e.inputErrorClass,c=e.errorClass;Array.from(document.querySelectorAll("".concat(t))).forEach((function(e){var t=Array.from(e.querySelectorAll("".concat(n))),l=e.querySelector("".concat(o));i(t,l,r),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n,o):function(e,t,n,o,r){var a=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(o)),a.textContent=n,a.classList.add("".concat(r))}(e,t,t.validationMessage,n,o)}(e,n,a,c),i(t,l,r)}))}))}))}($),S.addEventListener("click",(function(){P.value=k.textContent,q.value=C.textContent,c(I,$),e(E)})),U.addEventListener("click",(function(){B.reset(),c(B,$),e(A)})),b.addEventListener("click",(function(){j.reset(),c(j,$),e(T)})),g.forEach((function(e){return e.addEventListener("click",n)})),I.addEventListener("submit",(function(e){return function(e){var t=e.profileTitle,n=e.profileDescription,o=e.nameInput,r=e.jobInput,c=e.closePopup,i=e.profileEditPopup,u=e.profileEditSaveButton,l=e.updateUserData;e.evt.preventDefault(),a(u,!0),t.textContent=o.value,n.textContent=r.value,l(o,r).then((function(e){t.textContent=e.name,n.textContent=e.about,c(i)})).catch((function(e){return console.log(e)})).finally((function(){a(u,!1)}))}({evt:e,profileTitle:k,profileDescription:C,nameInput:P,jobInput:q,closePopup:t,profileEditPopup:E,profileEditSaveButton:x,updateUserData:s})})),B.addEventListener("submit",(function(e){return function(e){var t=e.profileImage,n=e.profileImageLinkInput,o=e.closePopup,r=e.profileImageEditPopup,c=e.profileImageEditSaveButton,i=e.updateUserProfileImage;e.evt.preventDefault(),a(c,!0),i(n).then((function(e){t.style="background-image: url(".concat(e.avatar,");"),o(r)})).catch((function(e){return console.log(e)})).finally((function(){a(c,!1)}))}({evt:e,profileImage:U,profileImageLinkInput:D,closePopup:t,profileImageEditPopup:A,profileImageEditSaveButton:w,updateUserProfileImage:m})})),j.addEventListener("submit",(function(e){return function(e){var t=e.cardsContainer,n=e.newPlaceFormElement,o=e.placeInput,r=e.linkInput,c=e.renderCards,i=e.openImagePopup,u=e.closePopup,l=e.placeAddPopup,s=e.newPlaceSaveButton,d=e.postCardData;e.evt.preventDefault();var p=s.textContent;a(s,!0),d(o,r).then((function(e){c({cardList:[e],cardsContainer:t,openImagePopup:i,positionBefore:!0}),n.reset(),u(l)})).catch((function(e){return console.log(e)})).finally((function(){a(s,!1,p)}))}({evt:e,cardsContainer:_,newPlaceFormElement:j,placeInput:O,linkInput:M,renderCards:G,openImagePopup:K,closePopup:t,placeAddPopup:T,newPlaceSaveButton:N,postCardData:d})})),z.addEventListener("click",(function(){var e,n=localStorage.getItem("deletedCardId"),o=document.querySelector('[data-id="'.concat(n,'"]'));(e=n,fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return v(e)}))).then((function(){o.remove(),t(H)})).catch((function(e){return console.log(e)}))}))})();